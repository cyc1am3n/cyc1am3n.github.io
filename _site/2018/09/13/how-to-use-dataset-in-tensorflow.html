<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <!-- Favicon code from realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#8b51a3">
<meta name="msapplication-TileColor" content="#563d7c">
<meta name="theme-color" content="#ffffff">

  <!--jQuery-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TensorFlow에서 Dataset을 사용하는 방법 | Daeyoung Kim</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="TensorFlow에서 Dataset을 사용하는 방법" />
<meta name="author" content="cyc1am3n" />
<meta property="og:locale" content="en_GB" />
<meta name="description" content="이 포스트는 Francesco Saverio 님의 How to use Dataset in TensorFlow 를 한글로 번역한 것 입니다." />
<meta property="og:description" content="이 포스트는 Francesco Saverio 님의 How to use Dataset in TensorFlow 를 한글로 번역한 것 입니다." />
<link rel="canonical" href="http://localhost:4000/2018/09/13/how-to-use-dataset-in-tensorflow.html" />
<meta property="og:url" content="http://localhost:4000/2018/09/13/how-to-use-dataset-in-tensorflow.html" />
<meta property="og:site_name" content="Daeyoung Kim" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-13T20:15:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TensorFlow에서 Dataset을 사용하는 방법" />
<meta name="twitter:site" content="@daeyoung__k" />
<meta name="twitter:creator" content="@cyc1am3n" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"cyc1am3n"},"dateModified":"2018-09-13T20:15:00+09:00","datePublished":"2018-09-13T20:15:00+09:00","description":"이 포스트는 Francesco Saverio 님의 How to use Dataset in TensorFlow 를 한글로 번역한 것 입니다.","headline":"TensorFlow에서 Dataset을 사용하는 방법","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/09/13/how-to-use-dataset-in-tensorflow.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/smile.png"},"name":"cyc1am3n"},"url":"http://localhost:4000/2018/09/13/how-to-use-dataset-in-tensorflow.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<!--jQuery-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<body>
  <div class="container">
    

<section id="header-nav">
  <header>
    <nav>
      <ul>
        
        <!-- others -->
        <a href="/">
          <li class="btn-nav">Home</li>
        </a>
        
        
        
          <a href="/blog">
            <li class="current btn-nav">Blog</li>
          </a>
          <a href="/tags">
            <li class="btn-nav">Tags</li>
          </a>
        
        
      </ul>
    </nav>
  </header>
</section>
<div id="post">
  <section class="post-header">
    <h1 class="title">TensorFlow에서 Dataset을 사용하는 방법</h1>
    <p class="subtitle">The built-in Input Pipeline. Never use ‘feed-dict’ anymore</p>
    <p class="meta">
      September 13, 2018
    </p>
  </section>
  <section class="post-content">
    <p>이 포스트는 <a href="https://towardsdatascience.com/how-to-use-dataset-in-tensorflow-c758ef9e4428">Francesco Saverio 님의 How to use Dataset in TensorFlow</a> 를 한글로 번역한 것 입니다.</p>

<h2 id="tensorflow에서-dataset을-사용하는-방법">TensorFlow에서 Dataset을 사용하는 방법</h2>

<p>TensorFlow에서 <code class="language-plaintext highlighter-rouge">feed-dict</code>만을 사용해서 데이터를 처리하는 것은 느리고 별로 권장되지는 않는다. 모델에 데이터를 제대로 공급하려면 입력 파이프라인을 만들어서 GPU로 들어올 데이터를 멈춰있게 하지 않아야 한다.</p>

<p>다행스럽게도 TensorFlow에서는 <code class="language-plaintext highlighter-rouge">Dataset</code> 이라는 built-in-API를 제공하고 있어서 위의 작업을 쉽게 처리할 수 있다. 이 포스트에서는 입력 파이프라인을 만들어서 모델에 데이터를 효율적으로 공급하는 방법을 살펴볼 것이다. 또한, 흔하게 볼 수 있는 예시를 다루면서 Dataset의 기본적인 메커니즘을 설명할 것이다.</p>

<hr />

<h3 id="개요">개요</h3>

<p>Dataset을 사용하려면 세 가지 단계를 거쳐야한다.</p>
<ol>
  <li><strong>데이터 불러오기.</strong> 사용하려는 데이터로부터 Dataset 인스턴스를 만든다.</li>
  <li><strong>Iterator(반복자) 생성하기.</strong> 생성된 데이터를 사용해서 Iterator 인스턴스를 만들어 Dataset을 iterate시킨다.</li>
  <li><strong>데이터 사용하기.</strong> 생성된 iterator를 사용해서 모델에 공급할 dataset으로부터 요소를 가져올 수 있다.</li>
</ol>

<hr />

<h3 id="데이터-불러오기">데이터 불러오기</h3>

<p>일단 dataset안에 넣을 데이터가 필요하다.</p>

<h4 id="numpy에서-불러오기">numpy에서 불러오기</h4>
<p>numpy 배열이 있고 그걸 tensorflow로 넣는 흔한 케이스이다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create a random vector of shape (100,2)
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<p>또한 데이터를 특성(feature)과 라벨(label)로 나누어 사용하는 경우처럼, 한 개 이상의 numpy 배열을 넣을 수도 있다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">))</span></code></pre></figure>

<h4 id="tensor에서-불러오기">tensor에서 불러오기</h4>
<p>tensor를 사용해서 dataset을 초기화 할 수도 있다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># using a tensor
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">random_uniform</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span></code></pre></figure>

<h4 id="placeholder에서-불러오기">Placeholder에서 불러오기</h4>
<p>dataset안의 데이터의 동적 변경을 할 때 유용한 방법인데, 자세한 내용은 아래에서 살펴보겠다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<h4 id="generator에서-불러오기">generator에서 불러오기</h4>
<p>generator를 사용해서 dataset을 초기화 할 수 있는데, 데이터의 원소들이 다른 크기를 가지고 있을 때 유용하다. 이런 경우에 tensor를 만들 때 사용할 데이터의 type과 shape도 지정해야 한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># from generator
</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">1</span><span class="p">]],[[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">]],[[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">]]])</span>
<span class="k">def</span> <span class="nf">generator</span><span class="p">():</span>
<span class="err">​</span>    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
<span class="err">​</span>        <span class="k">yield</span> <span class="n">el</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">().</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">from_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span>
<span class="err">​</span>                                           <span class="n">output_types</span><span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">int64</span><span class="p">,</span> 
<span class="err">​</span>                                           <span class="n">output_shapes</span><span class="o">=</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">])))</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">)</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span></code></pre></figure>

<p>출력은 다음과 같다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span>
<span class="p">[[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="p">[[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]]</span></code></pre></figure>

<h4 id="csv파일에서-불러오기">csv파일에서 불러오기</h4>
<p>csv파일에서 dataset으로 직접적으로 읽어올 수도 있다. 다음과 같이 트윗(text)과 좋아요(sentiment)가 들어있는 csv파일이 있다고 해보자.</p>

<p style="text-align: center;"><img src="/img/posts/dataset-in-tensorflow/tweets_csv.png" alt="tweets.csv" width="50%" height="50%" /></p>

<p>여기서 <code class="language-plaintext highlighter-rouge">tf.contrib.data.make_csv_dataset</code>을 사용하면 쉽게 <code class="language-plaintext highlighter-rouge">Dataset</code>을 만들 수 있다. Iterator는 column의 이름을 key로 하고 row 값을 가진 Tensor를 value로 하는 딕셔너리를 만든다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># load a csv
</span><span class="n">CSV_PATH</span> <span class="o">=</span> <span class="s">'./tweets.csv'</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">contrib</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">make_csv_dataset</span><span class="p">(</span><span class="n">CSV_PATH</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="nb">next</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span> <span class="c1"># next is a dict with key=columns names and value=column data
</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">[</span><span class="s">'text'</span><span class="p">],</span> <span class="nb">next</span><span class="p">[</span><span class="s">'sentiment'</span><span class="p">]</span>
<span class="k">with</span>  <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span></code></pre></figure>

<p>next는 다음을 나타낸다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">{</span><span class="s">'sentiment'</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">tf</span><span class="p">.</span><span class="n">Tensor</span> <span class="s">'IteratorGetNext_15:0'</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="err">?</span><span class="p">,)</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="o">&gt;</span><span class="p">,</span>
<span class="s">'text'</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">tf</span><span class="p">.</span><span class="n">Tensor</span> <span class="s">'IteratorGetNext_15:1'</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="err">?</span><span class="p">,)</span> <span class="n">dtype</span><span class="o">=</span><span class="n">string</span><span class="o">&gt;</span><span class="p">}</span></code></pre></figure>

<hr />

<h3 id="iterator반복자-생성하기">Iterator(반복자) 생성하기</h3>
<p>Dataset을 생성하고 나면 어떻게 데이터를 받을 수 있을까? 이 때는 Iterator를 사용해서 dataset을 통해 iterate하고 데이터에서 실제 값을 받아올 수 있다.<br />
Iterator에는 다음과 같이 네 가지 타입이 존재한다.</p>
<ol>
  <li><strong>One shot.</strong> Dataset을 통해 한 번만 iterate할 수 있고, 여기에 추가적으로 어떠한 값도 공급할 수 없다.</li>
  <li><strong>Initializable.</strong> feed-dict를 통해서 초기화 연산 호출과 새로운 데이터 전달을 동적으로 변경할 수 있다. feed-dict는 데이터를 담을 수 있는 버킷이다.</li>
  <li><strong>Reinitializable.</strong> 다른 Dataset을 통해서 초기화 될 수 있다. 셔플과 같이 추가적인 변형이 필요한 training dataset과 testing dataset을 가지고 있을 때 효과적으로 쓸 수 있다.  마치 각기 다른 컨테이너를 고르는 타워 크레인같은 역할을 한다.</li>
  <li><strong>Feedable.</strong> 사용하려는 iterator를 선택하는데 사용할 수 있다. 위의 비유와 연관지으면 타워 크레인을 고르는 타워 크레인이라고 할 수 있겠다. 필자의 의견으로는 쓸모가 없어보인다.</li>
</ol>

<h4 id="one-shot-iterator">One-shot Iterator</h4>
<p>가장 간단한 iterator이다. 처음의 예를 사용하면</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># create the iterator
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span></code></pre></figure>

<p>그러면 데이터를 포함할 tensor를 얻기 위해서 <code class="language-plaintext highlighter-rouge">get_next()</code>를 호출해야 한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">...</span>
<span class="c1"># create the iterator
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>값을 보려면 <code class="language-plaintext highlighter-rouge">el</code> 을 실행시키면 된다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="c1"># output: [ 0.42116176  0.40666069]</span></code></pre></figure>

<h4 id="initializable-iterator">Initializable Iterator</h4>
<p>데이터의 런타임을 변경할 수 있는 동적인 dataset을 만들고 싶을 때, placeholder를 사용할 수 있다. 그리고 <code class="language-plaintext highlighter-rouge">feed-dict</code>를 사용해서 placeholder를 초기화 할 수 있는데, 이게 initializable iterator로 수행되는 것이다. 아까 위에서 했던 예를 사용하면 다음과 같은데,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># using a placeholder
</span><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span> <span class="c1"># create the iterator
</span><span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="c1"># feed the placeholder with data
</span><span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">data</span> <span class="p">})</span> 
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="c1"># output [ 0.52374458  0.71968478]</span></code></pre></figure>

<p>이때 <code class="language-plaintext highlighter-rouge">make_initializable_iterator</code>을 호출 한다. 그러면 sess가 있는 with 블록 안에서 데이터를 보내기 위해서 <code class="language-plaintext highlighter-rouge">initializer</code>명령어를 실행시키는데, 여기에서는 랜덤 numpy 배열이 데이터에 해당한다.</p>

<p>이제 흔하게 볼 수 있는 train과 test set이 있는 상황을 생각해보자.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span></code></pre></figure>

<p>그러면 모델을 학습시킨 후에 test dataset으로 평가해야 할 텐데, iterator를 초기화해서 사용한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># initializable iterator to switch between dataset
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="c1">#     initialise iterator with train data
</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
        <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span>
<span class="c1">#     switch to test data
</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">]))</span></code></pre></figure>

<h4 id="reinitializable-iterator">Reinitializable Iterator</h4>
<p>데이터끼리의 동적 변경을 하는 initializable iterator와 컨셉은 비슷한데, 같은 dataset에 새로운 데이터를 넣는 것 대신에 dataset 자체를 바꿀 것이다. 아까처럼 train과 test data가 있다고 해보자.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># making fake data using numpy
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span></code></pre></figure>

<p>여기서 두 개의 Dataset을 만들 수 있는데,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create two datasets, one for training and one for test
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span></code></pre></figure>

<p>여기에서 generic Iterator를 만들어보자.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create a iterator of the correct shape and type
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span>
<span class="err">​</span>                                           <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span></code></pre></figure>

<p>그리고 두 개의 초기화 연산도 만들자.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create the initialisation operations
</span><span class="n">train_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">test_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span></code></pre></figure>

<p>전과 같이 get_next를 통해서 다음 원소를 얻을 수 있다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>이제 session을 사용해서 직접 두 개의 초기화 연산을 실행 시킬 수 있는데, 위에 했던걸 합치면 다음과 같다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Reinitializable iterator to switch between Datasets
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># making fake data using numpy
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="c1"># create two datasets, one for training and one for test
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
<span class="c1"># create a iterator of the correct shape and type
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span>
<span class="err">​</span>                                           <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># create the initialisation operations
</span><span class="n">train_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">test_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_init_op</span><span class="p">)</span> <span class="c1"># switch to train dataset
</span><span class="err">​</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">​</span>        <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_init_op</span><span class="p">)</span> <span class="c1"># switch to val dataset
</span><span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">]))</span></code></pre></figure>

<h4 id="feedable-iterator">Feedable Iterator</h4>
<p><code class="language-plaintext highlighter-rouge">reinitializable</code> iterator와 매우 비슷한데, dataset의 전환 대신에 iterator의 전환을 한다. 다음과 같이 두 개의 dataset을 만들고,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span></code></pre></figure>

<p>그 다음에 iterator를 만들 수 있다. 여기에서는 <code class="language-plaintext highlighter-rouge">initializable</code> iterator를 사용하는데, <code class="language-plaintext highlighter-rouge">one shot</code> iterator 또한 사용가능하다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train_iterator</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">test_iterator</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span></code></pre></figure>

<p>이제 동적으로 변경이 가능한 placeholder인 <code class="language-plaintext highlighter-rouge">handle</code>을 만든다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">handle</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">string</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[])</span></code></pre></figure>

<p>그리고 전과 같이, dataset의 shape를 이용해서 generic iterator를 만든다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_string_handle</span><span class="p">(</span>
<span class="err">​</span>    <span class="n">handle</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span></code></pre></figure>

<p>또 get_next로 다음 원소를 받을 수 있고,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">next_elements</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>iterator의 변경을 위해서 <code class="language-plaintext highlighter-rouge">next_elements</code>을 실행시켜서 feed_dict에 정확한 <code class="language-plaintext highlighter-rouge">handle</code>이 들어갈 수 있게 한다. 예를 들어 train set에서 한 개의 원소를 받아오려면 다음과 같이 한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_elements</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">train_handle</span><span class="p">})</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">initializable</code> iterator를 사용하려면 그냥 시작 전에 초기화 시켜주기만 하면 된다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span></code></pre></figure>

<p>이걸 종합해보면 다음과 같다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># feedable iterator to switch between iterators
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># making fake data using numpy
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="c1"># create placeholder
</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># create two datasets, one for training and one for test
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="c1"># create the iterators from the dataset
</span><span class="n">train_iterator</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">test_iterator</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="c1"># same as in the doc https://www.tensorflow.org/programmers_guide/datasets#creating_an_iterator
</span><span class="n">handle</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">string</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[])</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_string_handle</span><span class="p">(</span>
<span class="err">​</span>    <span class="n">handle</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span>
<span class="n">next_elements</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">train_handle</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">.</span><span class="n">string_handle</span><span class="p">())</span>
<span class="err">​</span>    <span class="n">test_handle</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">.</span><span class="n">string_handle</span><span class="p">())</span>
<span class="err">​</span>    
<span class="err">​</span>    <span class="c1"># initialise iterators. 
</span><span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="err">​</span>    
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_elements</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">train_handle</span><span class="p">})</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_elements</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">test_handle</span><span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></code></pre></figure>

<hr />

<h3 id="데이터-사용하기">데이터 사용하기</h3>

<p>위의 예제에서 Dataset에 있는 <code class="language-plaintext highlighter-rouge">next</code> 원소의 값을 출력하기 위해서 session을 사용했다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">...</span>
<span class="n">next_el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="p">...</span>
<span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_el</span><span class="p">))</span> <span class="c1"># will output the current element</span></code></pre></figure>

<p>모델에 데이터를 공급하기 위해서는 <code class="language-plaintext highlighter-rouge">get_next()</code>로 만들어진 tensor로 공급해야한다.</p>

<p>다음 부분에서는 이전의 예제에서 사용했던 두 개의 numpy 배열을 가진 Dataset을 사용했다. 데이터를 batch로 처리하는 데 필요한 차원을 추가하려면 다른 numpy 배열에 <code class="language-plaintext highlighter-rouge">.random.sample</code>을 래핑해야한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># using two numpy arrays
</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))]),</span> 
<span class="err">​</span>                    <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">))]))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">)).</span><span class="n">repeat</span><span class="p">().</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span></code></pre></figure>

<p>그리고 언제나 그랬듯이 iterator를 만들어야한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>간단한 neural network model을 만들어보았다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span></code></pre></figure>

<p>첫 번째 레이어의 입력과 loss function의 라벨로 <code class="language-plaintext highlighter-rouge">iter.get_next()</code>에서 나온 Tensor를 <strong>직접적으로</strong> 사용한다. 이제 종합해보자.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="c1"># using two numpy arrays
</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))]),</span> 
<span class="err">​</span>                    <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">))]))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">)).</span><span class="n">repeat</span><span class="p">().</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="err">​</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">​</span>        <span class="n">_</span><span class="p">,</span> <span class="n">loss_value</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">train_op</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
<span class="err">​</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Iter: {}, Loss: {:.4f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">loss_value</span><span class="p">))</span></code></pre></figure>

<p>결과는 다음과 같다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Iter</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1328</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1312</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1296</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1281</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1267</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1254</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1242</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1231</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1220</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1210</span></code></pre></figure>

<hr />

<h3 id="유용한-것들">유용한 것들</h3>
<h4 id="batch">Batch</h4>
<p>일반적으로 데이터를 batch 시키는 것에는 문제가 많은데, <code class="language-plaintext highlighter-rouge">Dataset</code> API를 사용하면 주어진 크기로 데이터 세트를 자동으로 처리하는<code class="language-plaintext highlighter-rouge">batch(BATCH_SIZE)</code>메서드를 사용할 수 있다. 기본 batch size는 1이고, 다음의 예에서는 4이다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># BATCHING
</span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> </code></pre></figure>

<p>결과는 다음과 같다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span> <span class="mf">0.65686128</span>  <span class="mf">0.99373963</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.69690451</span>  <span class="mf">0.32446826</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.57148422</span>  <span class="mf">0.68688242</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.20335116</span>  <span class="mf">0.82473219</span><span class="p">]]</span></code></pre></figure>

<h4 id="repeat">Repeat</h4>
<p><code class="language-plaintext highlighter-rouge">.repeat()</code>를 사용하면 dataset이 몇 번 반복해서 사용될 지 정할 수 있다. 파라미터가 없다면 계속 반복하고 보통 계속 반복시키고 epoch 값을 직접 제어하는 것이 좋다.</p>

<h4 id="shuffle">Shuffle</h4>
<p><code class="language-plaintext highlighter-rouge">shuffle()</code>을 사용하면 설정된 epoch마다 Dataset을 섞을 수 있다.</p>

<p>Dataset의 shuffle은 <strong>overfitting</strong>을 피할 때 매우 중요하다.</p>

<p>또한 아래의 예처럼 다음 원소가 일정하게 선택되는 고정된 버퍼의 크기인 <code class="language-plaintext highlighter-rouge">buffer_size</code> 파라미터를 설정 할 수 있다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># BATCHING
</span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">]])</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span></code></pre></figure>

<p>첫 실행 결과:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">4</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">]]</span></code></pre></figure>

<p>두 번째 실행 결과:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]]</span></code></pre></figure>

<p>원한다면 shuffle에 <code class="language-plaintext highlighter-rouge">seed</code> parameter를 설정 할 수도 있다.</p>

<h4 id="map">Map</h4>
<p><code class="language-plaintext highlighter-rouge">map</code> 함수를 이용해서 dataset의 각 멤버에 사용자 지정 함수를 적용할 수 있다. 다음 예제에서는 각 원소에 2를 곱한다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># MAP
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">]])</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="c1">#     this will run forever
</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span></code></pre></figure>

<p>결과:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="p">[</span><span class="mi">8</span><span class="p">]</span></code></pre></figure>

<hr />

<h3 id="전체-예제">전체 예제</h3>
<h4 id="initializable-iterator-1">Initializable iterator</h4>
<p>이 예제에서는 batching을 이용해서 간단한 모델을 학습시키고 <strong>Initializable iterator</strong>를 사용해서 train과 test dataset간에 전환을 할 것이다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Wrapping all together -&gt; Switch between train and test set using Initializable iterator
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># create a placeholder to dynamically switch between batch sizes
</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">int64</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">).</span><span class="n">repeat</span><span class="p">()</span>

<span class="c1"># using two numpy arrays
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>

<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>

<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="err">​</span>    <span class="c1"># initialise iterator with train data
</span><span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="n">BATCH_SIZE</span><span class="p">})</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Training...'</span><span class="p">)</span>
<span class="err">​</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">​</span>        <span class="n">tot_loss</span> <span class="o">=</span> <span class="mi">0</span>
<span class="err">​</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batches</span><span class="p">):</span>
<span class="err">​</span>            <span class="n">_</span><span class="p">,</span> <span class="n">loss_value</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">train_op</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
<span class="err">​</span>            <span class="n">tot_loss</span> <span class="o">+=</span> <span class="n">loss_value</span>
<span class="err">​</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Iter: {}, Loss: {:.4f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tot_loss</span> <span class="o">/</span> <span class="n">n_batches</span><span class="p">))</span>
<span class="err">​</span>    <span class="c1"># initialise iterator with test data
</span><span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Test Loss: {:4f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">loss</span><span class="p">)))</span></code></pre></figure>

<p><strong>학습 후 dataset을 동적으로 전환 하려면 batch size에 대해서 placeholder를 사용해야 한다.</strong></p>

<p>결과:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Training</span><span class="p">...</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.2977</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.2152</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1787</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1597</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1277</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1334</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1000</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1154</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.0989</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.0948</span>
<span class="n">Test</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.082150</span></code></pre></figure>

<h4 id="reinitializable-iterator-1">Reinitializable Iterator</h4>
<p>이 예제에서는 batch를 사용해서 간단한 모델을 학습시키고 <strong>Reinitializable Iterator</strong>을 사용해서 train과 test dataset간의 전환을 할 것이다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Wrapping all together -&gt; Switch between train and test set using Reinitializable iterator
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># create a placeholder to dynamically switch between batch sizes
</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">int64</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">).</span><span class="n">repeat</span><span class="p">()</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span> <span class="c1"># always batch even if you want to one shot it
# using two numpy arrays
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>

<span class="c1"># create a iterator of the correct shape and type
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span>
<span class="err">​</span>                                           <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span>
<span class="err">​</span>										   <span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># create the initialisation operations
</span><span class="n">train_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">test_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>

<span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>

<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="err">​</span>    <span class="c1"># initialise iterator with train data
</span><span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_init_op</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Training...'</span><span class="p">)</span>
<span class="err">​</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">​</span>        <span class="n">tot_loss</span> <span class="o">=</span> <span class="mi">0</span>
<span class="err">​</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batches</span><span class="p">):</span>
<span class="err">​</span>            <span class="n">_</span><span class="p">,</span> <span class="n">loss_value</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">train_op</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
<span class="err">​</span>            <span class="n">tot_loss</span> <span class="o">+=</span> <span class="n">loss_value</span>
<span class="err">​</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Iter: {}, Loss: {:.4f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tot_loss</span> <span class="o">/</span> <span class="n">n_batches</span><span class="p">))</span>
<span class="err">​</span>    <span class="c1"># initialise iterator with test data
</span><span class="err">​</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_init_op</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
<span class="err">​</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Test Loss: {:4f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">loss</span><span class="p">)))</span></code></pre></figure>

<hr />

<h3 id="마무리-지으면서">마무리 지으면서…</h3>
<p><code class="language-plaintext highlighter-rouge">Dataset</code> API를 통해서 최적화된 입력 파이프라인을 만들어 모델을 학습, 평가, 테스트 할 수 있는 빠르고 강력한 방법을 사용할 수 있다. 이 포스트에서는 우리가 흔히 볼 수 있는 일반적인 작업의 대부분을 살펴보았다.</p>

<hr />

<h3 id="other-resources">Other resources</h3>
<p>TensorFlow dataset tutorial: <a href="https://www.tensorflow.org/programmers_guide/datasets">https://www.tensorflow.org/programmers_guide/datasets</a></p>

<p>Dataset docs:</p>

<p><a href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset">https://www.tensorflow.org/api_docs/python/tf/data/Dataset</a></p>


  </section>
</div>

<div id="top" class="top-btn" onclick="moveTop()">
  <i class="fas fa-chevron-up"></i>
</div>

<script>
  var lastScrollTop = 0;
  window.onscroll = function () {
    var st = document.body.scrollTop || document.documentElement.scrollTop;
    if (st > 250) {
      document.getElementById("top").style.display = "block"
      if (st > lastScrollTop) {
        document.getElementById("top").style.opacity = 0
      } else {
        document.getElementById("top").style.opacity = 1
      }
    } else {
      document.getElementById("top").style.opacity = 0
      if (st > lastScrollTop) {
        document.getElementById("top").style.display = "none"
      }
    }
    lastScrollTop = st <= 0 ? 0 : st;
  }
  function moveTop() {
    document.body.scrollTop = 0
    document.documentElement.scrollTop = 0
  }
</script>

<!-- Footer -->
<footer>
  <div class="footer">
    Copyright © 2022
    <a href="https://cyc1am3n.github.io">Daeyoung Kim</a>.
  </div>
</footer>

  </div>
</body>

</html>