I"ôŒ<p>ì´ í¬ìŠ¤íŠ¸ëŠ” <a href="https://towardsdatascience.com/how-to-use-dataset-in-tensorflow-c758ef9e4428">Francesco Saverio ë‹˜ì˜ How to use Dataset in TensorFlow</a> ë¥¼ í•œê¸€ë¡œ ë²ˆì—­í•œ ê²ƒ ì…ë‹ˆë‹¤.</p>

<h2 id="tensorflowì—ì„œ-datasetì„-ì‚¬ìš©í•˜ëŠ”-ë°©ë²•">TensorFlowì—ì„œ Datasetì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•</h2>

<p>TensorFlowì—ì„œ <code class="language-plaintext highlighter-rouge">feed-dict</code>ë§Œì„ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ ëŠë¦¬ê³  ë³„ë¡œ ê¶Œì¥ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ëª¨ë¸ì— ë°ì´í„°ë¥¼ ì œëŒ€ë¡œ ê³µê¸‰í•˜ë ¤ë©´ ì…ë ¥ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ì–´ì„œ GPUë¡œ ë“¤ì–´ì˜¬ ë°ì´í„°ë¥¼ ë©ˆì¶°ìˆê²Œ í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.</p>

<p>ë‹¤í–‰ìŠ¤ëŸ½ê²Œë„ TensorFlowì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">Dataset</code> ì´ë¼ëŠ” built-in-APIë¥¼ ì œê³µí•˜ê³  ìˆì–´ì„œ ìœ„ì˜ ì‘ì—…ì„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì…ë ¥ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ì–´ì„œ ëª¨ë¸ì— ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê³µê¸‰í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³¼ ê²ƒì´ë‹¤. ë˜í•œ, í”í•˜ê²Œ ë³¼ ìˆ˜ ìˆëŠ” ì˜ˆì‹œë¥¼ ë‹¤ë£¨ë©´ì„œ Datasetì˜ ê¸°ë³¸ì ì¸ ë©”ì»¤ë‹ˆì¦˜ì„ ì„¤ëª…í•  ê²ƒì´ë‹¤.</p>

<hr />

<h3 id="ê°œìš”">ê°œìš”</h3>

<p>Datasetì„ ì‚¬ìš©í•˜ë ¤ë©´ ì„¸ ê°€ì§€ ë‹¨ê³„ë¥¼ ê±°ì³ì•¼í•œë‹¤.</p>
<ol>
  <li><strong>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°.</strong> ì‚¬ìš©í•˜ë ¤ëŠ” ë°ì´í„°ë¡œë¶€í„° Dataset ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.</li>
  <li><strong>Iterator(ë°˜ë³µì) ìƒì„±í•˜ê¸°.</strong> ìƒì„±ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì„œ Iterator ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ Datasetì„ iterateì‹œí‚¨ë‹¤.</li>
  <li><strong>ë°ì´í„° ì‚¬ìš©í•˜ê¸°.</strong> ìƒì„±ëœ iteratorë¥¼ ì‚¬ìš©í•´ì„œ ëª¨ë¸ì— ê³µê¸‰í•  datasetìœ¼ë¡œë¶€í„° ìš”ì†Œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</li>
</ol>

<hr />

<h3 id="ë°ì´í„°-ë¶ˆëŸ¬ì˜¤ê¸°">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</h3>

<p>ì¼ë‹¨ datasetì•ˆì— ë„£ì„ ë°ì´í„°ê°€ í•„ìš”í•˜ë‹¤.</p>

<h4 id="numpyì—ì„œ-ë¶ˆëŸ¬ì˜¤ê¸°">numpyì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</h4>
<p>numpy ë°°ì—´ì´ ìˆê³  ê·¸ê±¸ tensorflowë¡œ ë„£ëŠ” í”í•œ ì¼€ì´ìŠ¤ì´ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create a random vector of shape (100,2)
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<p>ë˜í•œ ë°ì´í„°ë¥¼ íŠ¹ì„±(feature)ê³¼ ë¼ë²¨(label)ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì²˜ëŸ¼, í•œ ê°œ ì´ìƒì˜ numpy ë°°ì—´ì„ ë„£ì„ ìˆ˜ë„ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">))</span></code></pre></figure>

<h4 id="tensorì—ì„œ-ë¶ˆëŸ¬ì˜¤ê¸°">tensorì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</h4>
<p>tensorë¥¼ ì‚¬ìš©í•´ì„œ datasetì„ ì´ˆê¸°í™” í•  ìˆ˜ë„ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># using a tensor
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">random_uniform</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span></code></pre></figure>

<h4 id="placeholderì—ì„œ-ë¶ˆëŸ¬ì˜¤ê¸°">Placeholderì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</h4>
<p>datasetì•ˆì˜ ë°ì´í„°ì˜ ë™ì  ë³€ê²½ì„ í•  ë•Œ ìœ ìš©í•œ ë°©ë²•ì¸ë°, ìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ì—ì„œ ì‚´í´ë³´ê² ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<h4 id="generatorì—ì„œ-ë¶ˆëŸ¬ì˜¤ê¸°">generatorì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</h4>
<p>generatorë¥¼ ì‚¬ìš©í•´ì„œ datasetì„ ì´ˆê¸°í™” í•  ìˆ˜ ìˆëŠ”ë°, ë°ì´í„°ì˜ ì›ì†Œë“¤ì´ ë‹¤ë¥¸ í¬ê¸°ë¥¼ ê°€ì§€ê³  ìˆì„ ë•Œ ìœ ìš©í•˜ë‹¤. ì´ëŸ° ê²½ìš°ì— tensorë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©í•  ë°ì´í„°ì˜ typeê³¼ shapeë„ ì§€ì •í•´ì•¼ í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># from generator
</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">1</span><span class="p">]],[[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">]],[[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">]]])</span>
<span class="k">def</span> <span class="nf">generator</span><span class="p">():</span>
<span class="err">â€‹</span>    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
<span class="err">â€‹</span>        <span class="k">yield</span> <span class="n">el</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">().</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">from_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span>
<span class="err">â€‹</span>                                           <span class="n">output_types</span><span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">int64</span><span class="p">,</span> 
<span class="err">â€‹</span>                                           <span class="n">output_shapes</span><span class="o">=</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">])))</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">)</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span></code></pre></figure>

<p>ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span>
<span class="p">[[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="p">[[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]]</span></code></pre></figure>

<h4 id="csvíŒŒì¼ì—ì„œ-ë¶ˆëŸ¬ì˜¤ê¸°">csvíŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</h4>
<p>csvíŒŒì¼ì—ì„œ datasetìœ¼ë¡œ ì§ì ‘ì ìœ¼ë¡œ ì½ì–´ì˜¬ ìˆ˜ë„ ìˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ íŠ¸ìœ—(text)ê³¼ ì¢‹ì•„ìš”(sentiment)ê°€ ë“¤ì–´ìˆëŠ” csvíŒŒì¼ì´ ìˆë‹¤ê³  í•´ë³´ì.</p>

<p style="text-align: center;"><img src="/assets/img/posts/dataset-in-tensorflow/tweets_csv.png" alt="tweets.csv" width="50%" height="50%" /></p>

<p>ì—¬ê¸°ì„œ <code class="language-plaintext highlighter-rouge">tf.contrib.data.make_csv_dataset</code>ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ <code class="language-plaintext highlighter-rouge">Dataset</code>ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. IteratorëŠ” columnì˜ ì´ë¦„ì„ keyë¡œ í•˜ê³  row ê°’ì„ ê°€ì§„ Tensorë¥¼ valueë¡œ í•˜ëŠ” ë”•ì…”ë„ˆë¦¬ë¥¼ ë§Œë“ ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># load a csv
</span><span class="n">CSV_PATH</span> <span class="o">=</span> <span class="s">'./tweets.csv'</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">contrib</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">make_csv_dataset</span><span class="p">(</span><span class="n">CSV_PATH</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="nb">next</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span> <span class="c1"># next is a dict with key=columns names and value=column data
</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">[</span><span class="s">'text'</span><span class="p">],</span> <span class="nb">next</span><span class="p">[</span><span class="s">'sentiment'</span><span class="p">]</span>
<span class="k">with</span>  <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span></code></pre></figure>

<p>nextëŠ” ë‹¤ìŒì„ ë‚˜íƒ€ë‚¸ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">{</span><span class="s">'sentiment'</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">tf</span><span class="p">.</span><span class="n">Tensor</span> <span class="s">'IteratorGetNext_15:0'</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="err">?</span><span class="p">,)</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="o">&gt;</span><span class="p">,</span>
<span class="s">'text'</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">tf</span><span class="p">.</span><span class="n">Tensor</span> <span class="s">'IteratorGetNext_15:1'</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="err">?</span><span class="p">,)</span> <span class="n">dtype</span><span class="o">=</span><span class="n">string</span><span class="o">&gt;</span><span class="p">}</span></code></pre></figure>

<hr />

<h3 id="iteratorë°˜ë³µì-ìƒì„±í•˜ê¸°">Iterator(ë°˜ë³µì) ìƒì„±í•˜ê¸°</h3>
<p>Datasetì„ ìƒì„±í•˜ê³  ë‚˜ë©´ ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆì„ê¹Œ? ì´ ë•ŒëŠ” Iteratorë¥¼ ì‚¬ìš©í•´ì„œ datasetì„ í†µí•´ iterateí•˜ê³  ë°ì´í„°ì—ì„œ ì‹¤ì œ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.<br />
Iteratorì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë„¤ ê°€ì§€ íƒ€ì…ì´ ì¡´ì¬í•œë‹¤.</p>
<ol>
  <li><strong>One shot.</strong> Datasetì„ í†µí•´ í•œ ë²ˆë§Œ iterateí•  ìˆ˜ ìˆê³ , ì—¬ê¸°ì— ì¶”ê°€ì ìœ¼ë¡œ ì–´ë– í•œ ê°’ë„ ê³µê¸‰í•  ìˆ˜ ì—†ë‹¤.</li>
  <li><strong>Initializable.</strong> feed-dictë¥¼ í†µí•´ì„œ ì´ˆê¸°í™” ì—°ì‚° í˜¸ì¶œê³¼ ìƒˆë¡œìš´ ë°ì´í„° ì „ë‹¬ì„ ë™ì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. feed-dictëŠ” ë°ì´í„°ë¥¼ ë‹´ì„ ìˆ˜ ìˆëŠ” ë²„í‚·ì´ë‹¤.</li>
  <li><strong>Reinitializable.</strong> ë‹¤ë¥¸ Datasetì„ í†µí•´ì„œ ì´ˆê¸°í™” ë  ìˆ˜ ìˆë‹¤. ì…”í”Œê³¼ ê°™ì´ ì¶”ê°€ì ì¸ ë³€í˜•ì´ í•„ìš”í•œ training datasetê³¼ testing datasetì„ ê°€ì§€ê³  ìˆì„ ë•Œ íš¨ê³¼ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆë‹¤.  ë§ˆì¹˜ ê°ê¸° ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆë¥¼ ê³ ë¥´ëŠ” íƒ€ì›Œ í¬ë ˆì¸ê°™ì€ ì—­í• ì„ í•œë‹¤.</li>
  <li><strong>Feedable.</strong> ì‚¬ìš©í•˜ë ¤ëŠ” iteratorë¥¼ ì„ íƒí•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ìœ„ì˜ ë¹„ìœ ì™€ ì—°ê´€ì§€ìœ¼ë©´ íƒ€ì›Œ í¬ë ˆì¸ì„ ê³ ë¥´ëŠ” íƒ€ì›Œ í¬ë ˆì¸ì´ë¼ê³  í•  ìˆ˜ ìˆê² ë‹¤. í•„ìì˜ ì˜ê²¬ìœ¼ë¡œëŠ” ì“¸ëª¨ê°€ ì—†ì–´ë³´ì¸ë‹¤.</li>
</ol>

<h4 id="one-shot-iterator">One-shot Iterator</h4>
<p>ê°€ì¥ ê°„ë‹¨í•œ iteratorì´ë‹¤. ì²˜ìŒì˜ ì˜ˆë¥¼ ì‚¬ìš©í•˜ë©´</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># create the iterator
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span></code></pre></figure>

<p>ê·¸ëŸ¬ë©´ ë°ì´í„°ë¥¼ í¬í•¨í•  tensorë¥¼ ì–»ê¸° ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">get_next()</code>ë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">...</span>
<span class="c1"># create the iterator
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>ê°’ì„ ë³´ë ¤ë©´ <code class="language-plaintext highlighter-rouge">el</code> ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="c1"># output: [ 0.42116176  0.40666069]</span></code></pre></figure>

<h4 id="initializable-iterator">Initializable Iterator</h4>
<p>ë°ì´í„°ì˜ ëŸ°íƒ€ì„ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë™ì ì¸ datasetì„ ë§Œë“¤ê³  ì‹¶ì„ ë•Œ, placeholderë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  <code class="language-plaintext highlighter-rouge">feed-dict</code>ë¥¼ ì‚¬ìš©í•´ì„œ placeholderë¥¼ ì´ˆê¸°í™” í•  ìˆ˜ ìˆëŠ”ë°, ì´ê²Œ initializable iteratorë¡œ ìˆ˜í–‰ë˜ëŠ” ê²ƒì´ë‹¤. ì•„ê¹Œ ìœ„ì—ì„œ í–ˆë˜ ì˜ˆë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ë°,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># using a placeholder
</span><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span> <span class="c1"># create the iterator
</span><span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="c1"># feed the placeholder with data
</span><span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">data</span> <span class="p">})</span> 
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="c1"># output [ 0.52374458  0.71968478]</span></code></pre></figure>

<p>ì´ë•Œ <code class="language-plaintext highlighter-rouge">make_initializable_iterator</code>ì„ í˜¸ì¶œ í•œë‹¤. ê·¸ëŸ¬ë©´ sessê°€ ìˆëŠ” with ë¸”ë¡ ì•ˆì—ì„œ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸° ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">initializer</code>ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ”ë°, ì—¬ê¸°ì—ì„œëŠ” ëœë¤ numpy ë°°ì—´ì´ ë°ì´í„°ì— í•´ë‹¹í•œë‹¤.</p>

<p>ì´ì œ í”í•˜ê²Œ ë³¼ ìˆ˜ ìˆëŠ” trainê³¼ test setì´ ìˆëŠ” ìƒí™©ì„ ìƒê°í•´ë³´ì.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span></code></pre></figure>

<p>ê·¸ëŸ¬ë©´ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¨ í›„ì— test datasetìœ¼ë¡œ í‰ê°€í•´ì•¼ í•  í…ë°, iteratorë¥¼ ì´ˆê¸°í™”í•´ì„œ ì‚¬ìš©í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># initializable iterator to switch between dataset
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="c1">#     initialise iterator with train data
</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
        <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span>
<span class="c1">#     switch to test data
</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">]))</span></code></pre></figure>

<h4 id="reinitializable-iterator">Reinitializable Iterator</h4>
<p>ë°ì´í„°ë¼ë¦¬ì˜ ë™ì  ë³€ê²½ì„ í•˜ëŠ” initializable iteratorì™€ ì»¨ì…‰ì€ ë¹„ìŠ·í•œë°, ê°™ì€ datasetì— ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë„£ëŠ” ê²ƒ ëŒ€ì‹ ì— dataset ìì²´ë¥¼ ë°”ê¿€ ê²ƒì´ë‹¤. ì•„ê¹Œì²˜ëŸ¼ trainê³¼ test dataê°€ ìˆë‹¤ê³  í•´ë³´ì.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># making fake data using numpy
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span></code></pre></figure>

<p>ì—¬ê¸°ì„œ ë‘ ê°œì˜ Datasetì„ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë°,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create two datasets, one for training and one for test
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span></code></pre></figure>

<p>ì—¬ê¸°ì—ì„œ generic Iteratorë¥¼ ë§Œë“¤ì–´ë³´ì.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create a iterator of the correct shape and type
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span>
<span class="err">â€‹</span>                                           <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span></code></pre></figure>

<p>ê·¸ë¦¬ê³  ë‘ ê°œì˜ ì´ˆê¸°í™” ì—°ì‚°ë„ ë§Œë“¤ì.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create the initialisation operations
</span><span class="n">train_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">test_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span></code></pre></figure>

<p>ì „ê³¼ ê°™ì´ get_nextë¥¼ í†µí•´ì„œ ë‹¤ìŒ ì›ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>ì´ì œ sessionì„ ì‚¬ìš©í•´ì„œ ì§ì ‘ ë‘ ê°œì˜ ì´ˆê¸°í™” ì—°ì‚°ì„ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆëŠ”ë°, ìœ„ì— í–ˆë˜ê±¸ í•©ì¹˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Reinitializable iterator to switch between Datasets
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># making fake data using numpy
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="c1"># create two datasets, one for training and one for test
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
<span class="c1"># create a iterator of the correct shape and type
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span>
<span class="err">â€‹</span>                                           <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># create the initialisation operations
</span><span class="n">train_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">test_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_init_op</span><span class="p">)</span> <span class="c1"># switch to train dataset
</span><span class="err">â€‹</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">â€‹</span>        <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_init_op</span><span class="p">)</span> <span class="c1"># switch to val dataset
</span><span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">]))</span></code></pre></figure>

<h4 id="feedable-iterator">Feedable Iterator</h4>
<p><code class="language-plaintext highlighter-rouge">reinitializable</code> iteratorì™€ ë§¤ìš° ë¹„ìŠ·í•œë°, datasetì˜ ì „í™˜ ëŒ€ì‹ ì— iteratorì˜ ì „í™˜ì„ í•œë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ë‘ ê°œì˜ datasetì„ ë§Œë“¤ê³ ,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span></code></pre></figure>

<p>ê·¸ ë‹¤ìŒì— iteratorë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">initializable</code> iteratorë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, <code class="language-plaintext highlighter-rouge">one shot</code> iterator ë˜í•œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train_iterator</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">test_iterator</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span></code></pre></figure>

<p>ì´ì œ ë™ì ìœ¼ë¡œ ë³€ê²½ì´ ê°€ëŠ¥í•œ placeholderì¸ <code class="language-plaintext highlighter-rouge">handle</code>ì„ ë§Œë“ ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">handle</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">string</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[])</span></code></pre></figure>

<p>ê·¸ë¦¬ê³  ì „ê³¼ ê°™ì´, datasetì˜ shapeë¥¼ ì´ìš©í•´ì„œ generic iteratorë¥¼ ë§Œë“ ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_string_handle</span><span class="p">(</span>
<span class="err">â€‹</span>    <span class="n">handle</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span></code></pre></figure>

<p>ë˜ get_nextë¡œ ë‹¤ìŒ ì›ì†Œë¥¼ ë°›ì„ ìˆ˜ ìˆê³ ,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">next_elements</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>iteratorì˜ ë³€ê²½ì„ ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">next_elements</code>ì„ ì‹¤í–‰ì‹œì¼œì„œ feed_dictì— ì •í™•í•œ <code class="language-plaintext highlighter-rouge">handle</code>ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ train setì—ì„œ í•œ ê°œì˜ ì›ì†Œë¥¼ ë°›ì•„ì˜¤ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_elements</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">train_handle</span><span class="p">})</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">initializable</code> iteratorë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ê·¸ëƒ¥ ì‹œì‘ ì „ì— ì´ˆê¸°í™” ì‹œì¼œì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span></code></pre></figure>

<p>ì´ê±¸ ì¢…í•©í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># feedable iterator to switch between iterators
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># making fake data using numpy
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="c1"># create placeholder
</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># create two datasets, one for training and one for test
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="c1"># create the iterators from the dataset
</span><span class="n">train_iterator</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">test_iterator</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="c1"># same as in the doc https://www.tensorflow.org/programmers_guide/datasets#creating_an_iterator
</span><span class="n">handle</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">string</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[])</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_string_handle</span><span class="p">(</span>
<span class="err">â€‹</span>    <span class="n">handle</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span>
<span class="n">next_elements</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">train_handle</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">.</span><span class="n">string_handle</span><span class="p">())</span>
<span class="err">â€‹</span>    <span class="n">test_handle</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">.</span><span class="n">string_handle</span><span class="p">())</span>
<span class="err">â€‹</span>    
<span class="err">â€‹</span>    <span class="c1"># initialise iterators. 
</span><span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="err">â€‹</span>    
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_elements</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">train_handle</span><span class="p">})</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_elements</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">test_handle</span><span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></code></pre></figure>

<hr />

<h3 id="ë°ì´í„°-ì‚¬ìš©í•˜ê¸°">ë°ì´í„° ì‚¬ìš©í•˜ê¸°</h3>

<p>ìœ„ì˜ ì˜ˆì œì—ì„œ Datasetì— ìˆëŠ” <code class="language-plaintext highlighter-rouge">next</code> ì›ì†Œì˜ ê°’ì„ ì¶œë ¥í•˜ê¸° ìœ„í•´ì„œ sessionì„ ì‚¬ìš©í–ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">...</span>
<span class="n">next_el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="p">...</span>
<span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">next_el</span><span class="p">))</span> <span class="c1"># will output the current element</span></code></pre></figure>

<p>ëª¨ë¸ì— ë°ì´í„°ë¥¼ ê³µê¸‰í•˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">get_next()</code>ë¡œ ë§Œë“¤ì–´ì§„ tensorë¡œ ê³µê¸‰í•´ì•¼í•œë‹¤.</p>

<p>ë‹¤ìŒ ë¶€ë¶„ì—ì„œëŠ” ì´ì „ì˜ ì˜ˆì œì—ì„œ ì‚¬ìš©í–ˆë˜ ë‘ ê°œì˜ numpy ë°°ì—´ì„ ê°€ì§„ Datasetì„ ì‚¬ìš©í–ˆë‹¤. ë°ì´í„°ë¥¼ batchë¡œ ì²˜ë¦¬í•˜ëŠ” ë° í•„ìš”í•œ ì°¨ì›ì„ ì¶”ê°€í•˜ë ¤ë©´ ë‹¤ë¥¸ numpy ë°°ì—´ì— <code class="language-plaintext highlighter-rouge">.random.sample</code>ì„ ë˜í•‘í•´ì•¼í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># using two numpy arrays
</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))]),</span> 
<span class="err">â€‹</span>                    <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">))]))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">)).</span><span class="n">repeat</span><span class="p">().</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span></code></pre></figure>

<p>ê·¸ë¦¬ê³  ì–¸ì œë‚˜ ê·¸ë¬ë“¯ì´ iteratorë¥¼ ë§Œë“¤ì–´ì•¼í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span></code></pre></figure>

<p>ê°„ë‹¨í•œ neural network modelì„ ë§Œë“¤ì–´ë³´ì•˜ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span></code></pre></figure>

<p>ì²« ë²ˆì§¸ ë ˆì´ì–´ì˜ ì…ë ¥ê³¼ loss functionì˜ ë¼ë²¨ë¡œ <code class="language-plaintext highlighter-rouge">iter.get_next()</code>ì—ì„œ ë‚˜ì˜¨ Tensorë¥¼ <strong>ì§ì ‘ì ìœ¼ë¡œ</strong> ì‚¬ìš©í•œë‹¤. ì´ì œ ì¢…í•©í•´ë³´ì.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="c1"># using two numpy arrays
</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))]),</span> 
<span class="err">â€‹</span>                    <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">))]))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">)).</span><span class="n">repeat</span><span class="p">().</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="err">â€‹</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">â€‹</span>        <span class="n">_</span><span class="p">,</span> <span class="n">loss_value</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">train_op</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
<span class="err">â€‹</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Iter: {}, Loss: {:.4f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">loss_value</span><span class="p">))</span></code></pre></figure>

<p>ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Iter</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1328</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1312</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1296</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1281</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1267</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1254</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1242</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1231</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1220</span> 
<span class="n">Iter</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1210</span></code></pre></figure>

<hr />

<h3 id="ìœ ìš©í•œ-ê²ƒë“¤">ìœ ìš©í•œ ê²ƒë“¤</h3>
<h4 id="batch">Batch</h4>
<p>ì¼ë°˜ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ batch ì‹œí‚¤ëŠ” ê²ƒì—ëŠ” ë¬¸ì œê°€ ë§ì€ë°, <code class="language-plaintext highlighter-rouge">Dataset</code> APIë¥¼ ì‚¬ìš©í•˜ë©´ ì£¼ì–´ì§„ í¬ê¸°ë¡œ ë°ì´í„° ì„¸íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ”<code class="language-plaintext highlighter-rouge">batch(BATCH_SIZE)</code>ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ê¸°ë³¸ batch sizeëŠ” 1ì´ê³ , ë‹¤ìŒì˜ ì˜ˆì—ì„œëŠ” 4ì´ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># BATCHING
</span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> </code></pre></figure>

<p>ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span> <span class="mf">0.65686128</span>  <span class="mf">0.99373963</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.69690451</span>  <span class="mf">0.32446826</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.57148422</span>  <span class="mf">0.68688242</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.20335116</span>  <span class="mf">0.82473219</span><span class="p">]]</span></code></pre></figure>

<h4 id="repeat">Repeat</h4>
<p><code class="language-plaintext highlighter-rouge">.repeat()</code>ë¥¼ ì‚¬ìš©í•˜ë©´ datasetì´ ëª‡ ë²ˆ ë°˜ë³µí•´ì„œ ì‚¬ìš©ë  ì§€ ì •í•  ìˆ˜ ìˆë‹¤. íŒŒë¼ë¯¸í„°ê°€ ì—†ë‹¤ë©´ ê³„ì† ë°˜ë³µí•˜ê³  ë³´í†µ ê³„ì† ë°˜ë³µì‹œí‚¤ê³  epoch ê°’ì„ ì§ì ‘ ì œì–´í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>

<h4 id="shuffle">Shuffle</h4>
<p><code class="language-plaintext highlighter-rouge">shuffle()</code>ì„ ì‚¬ìš©í•˜ë©´ ì„¤ì •ëœ epochë§ˆë‹¤ Datasetì„ ì„ì„ ìˆ˜ ìˆë‹¤.</p>

<p>Datasetì˜ shuffleì€ <strong>overfitting</strong>ì„ í”¼í•  ë•Œ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.</p>

<p>ë˜í•œ ì•„ë˜ì˜ ì˜ˆì²˜ëŸ¼ ë‹¤ìŒ ì›ì†Œê°€ ì¼ì •í•˜ê²Œ ì„ íƒë˜ëŠ” ê³ ì •ëœ ë²„í¼ì˜ í¬ê¸°ì¸ <code class="language-plaintext highlighter-rouge">buffer_size</code> íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì • í•  ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># BATCHING
</span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">]])</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span></code></pre></figure>

<p>ì²« ì‹¤í–‰ ê²°ê³¼:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">4</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">]]</span></code></pre></figure>

<p>ë‘ ë²ˆì§¸ ì‹¤í–‰ ê²°ê³¼:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]]</span></code></pre></figure>

<p>ì›í•œë‹¤ë©´ shuffleì— <code class="language-plaintext highlighter-rouge">seed</code> parameterë¥¼ ì„¤ì • í•  ìˆ˜ë„ ìˆë‹¤.</p>

<h4 id="map">Map</h4>
<p><code class="language-plaintext highlighter-rouge">map</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ datasetì˜ ê° ë©¤ë²„ì— ì‚¬ìš©ì ì§€ì • í•¨ìˆ˜ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤. ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” ê° ì›ì†Œì— 2ë¥¼ ê³±í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># MAP
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">]])</span>
<span class="c1"># make a dataset from a numpy array
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">el</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="c1">#     this will run forever
</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">el</span><span class="p">))</span></code></pre></figure>

<p>ê²°ê³¼:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="p">[</span><span class="mi">8</span><span class="p">]</span></code></pre></figure>

<hr />

<h3 id="ì „ì²´-ì˜ˆì œ">ì „ì²´ ì˜ˆì œ</h3>
<h4 id="initializable-iterator-1">Initializable iterator</h4>
<p>ì´ ì˜ˆì œì—ì„œëŠ” batchingì„ ì´ìš©í•´ì„œ ê°„ë‹¨í•œ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¤ê³  <strong>Initializable iterator</strong>ë¥¼ ì‚¬ìš©í•´ì„œ trainê³¼ test datasetê°„ì— ì „í™˜ì„ í•  ê²ƒì´ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Wrapping all together -&gt; Switch between train and test set using Initializable iterator
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># create a placeholder to dynamically switch between batch sizes
</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">int64</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">).</span><span class="n">repeat</span><span class="p">()</span>

<span class="c1"># using two numpy arrays
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>

<span class="nb">iter</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>

<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="err">â€‹</span>    <span class="c1"># initialise iterator with train data
</span><span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="n">BATCH_SIZE</span><span class="p">})</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Training...'</span><span class="p">)</span>
<span class="err">â€‹</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">â€‹</span>        <span class="n">tot_loss</span> <span class="o">=</span> <span class="mi">0</span>
<span class="err">â€‹</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batches</span><span class="p">):</span>
<span class="err">â€‹</span>            <span class="n">_</span><span class="p">,</span> <span class="n">loss_value</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">train_op</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
<span class="err">â€‹</span>            <span class="n">tot_loss</span> <span class="o">+=</span> <span class="n">loss_value</span>
<span class="err">â€‹</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Iter: {}, Loss: {:.4f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tot_loss</span> <span class="o">/</span> <span class="n">n_batches</span><span class="p">))</span>
<span class="err">â€‹</span>    <span class="c1"># initialise iterator with test data
</span><span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nb">iter</span><span class="p">.</span><span class="n">initializer</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Test Loss: {:4f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">loss</span><span class="p">)))</span></code></pre></figure>

<p><strong>í•™ìŠµ í›„ datasetì„ ë™ì ìœ¼ë¡œ ì „í™˜ í•˜ë ¤ë©´ batch sizeì— ëŒ€í•´ì„œ placeholderë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</strong></p>

<p>ê²°ê³¼:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Training</span><span class="p">...</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.2977</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.2152</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1787</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1597</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1277</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1334</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1000</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.1154</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.0989</span>
<span class="n">Iter</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.0948</span>
<span class="n">Test</span> <span class="n">Loss</span><span class="p">:</span> <span class="mf">0.082150</span></code></pre></figure>

<h4 id="reinitializable-iterator-1">Reinitializable Iterator</h4>
<p>ì´ ì˜ˆì œì—ì„œëŠ” batchë¥¼ ì‚¬ìš©í•´ì„œ ê°„ë‹¨í•œ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¤ê³  <strong>Reinitializable Iterator</strong>ì„ ì‚¬ìš©í•´ì„œ trainê³¼ test datasetê°„ì˜ ì „í™˜ì„ í•  ê²ƒì´ë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Wrapping all together -&gt; Switch between train and test set using Reinitializable iterator
</span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># create a placeholder to dynamically switch between batch sizes
</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">int64</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">).</span><span class="n">repeat</span><span class="p">()</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span> <span class="c1"># always batch even if you want to one shot it
# using two numpy arrays
</span><span class="n">train_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>

<span class="c1"># create a iterator of the correct shape and type
</span><span class="nb">iter</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Iterator</span><span class="p">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">output_types</span><span class="p">,</span>
<span class="err">â€‹</span>                                           <span class="n">train_dataset</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">)</span>
<span class="err">â€‹</span>										   <span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="c1"># create the initialisation operations
</span><span class="n">train_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">test_init_op</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>

<span class="c1"># make a simple model
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span> <span class="c1"># pass the first value from iter.get_next() as input
</span><span class="n">net</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">dense</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">)</span>

<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="c1"># pass the second value from iter.get_net() as label
</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">().</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
<span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="err">â€‹</span>    <span class="c1"># initialise iterator with train data
</span><span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_init_op</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Training...'</span><span class="p">)</span>
<span class="err">â€‹</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
<span class="err">â€‹</span>        <span class="n">tot_loss</span> <span class="o">=</span> <span class="mi">0</span>
<span class="err">â€‹</span>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batches</span><span class="p">):</span>
<span class="err">â€‹</span>            <span class="n">_</span><span class="p">,</span> <span class="n">loss_value</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">train_op</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
<span class="err">â€‹</span>            <span class="n">tot_loss</span> <span class="o">+=</span> <span class="n">loss_value</span>
<span class="err">â€‹</span>        <span class="k">print</span><span class="p">(</span><span class="s">"Iter: {}, Loss: {:.4f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tot_loss</span> <span class="o">/</span> <span class="n">n_batches</span><span class="p">))</span>
<span class="err">â€‹</span>    <span class="c1"># initialise iterator with test data
</span><span class="err">â€‹</span>    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_init_op</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
<span class="err">â€‹</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Test Loss: {:4f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">loss</span><span class="p">)))</span></code></pre></figure>

<hr />

<h3 id="ë§ˆë¬´ë¦¬-ì§€ìœ¼ë©´ì„œ">ë§ˆë¬´ë¦¬ ì§€ìœ¼ë©´ì„œâ€¦</h3>
<p><code class="language-plaintext highlighter-rouge">Dataset</code> APIë¥¼ í†µí•´ì„œ ìµœì í™”ëœ ì…ë ¥ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ì–´ ëª¨ë¸ì„ í•™ìŠµ, í‰ê°€, í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆëŠ” ë¹ ë¥´ê³  ê°•ë ¥í•œ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ìš°ë¦¬ê°€ í”íˆ ë³¼ ìˆ˜ ìˆëŠ” ì¼ë°˜ì ì¸ ì‘ì—…ì˜ ëŒ€ë¶€ë¶„ì„ ì‚´í´ë³´ì•˜ë‹¤.</p>

<hr />

<h3 id="other-resources">Other resources</h3>
<p>TensorFlow dataset tutorial: <a href="https://www.tensorflow.org/programmers_guide/datasets">https://www.tensorflow.org/programmers_guide/datasets</a></p>

<p>Dataset docs:</p>

<p><a href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset">https://www.tensorflow.org/api_docs/python/tf/data/Dataset</a></p>

:ET